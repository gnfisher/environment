#!/usr/bin/env bash
set -euo pipefail

SCRIPT_NAME="$(basename "$0")"
SCRIPTS_DIR="${SCRIPTS_DIR:-$HOME/.local/bin}"

usage() {
    cat <<EOF
cs - Codespace tooling command launcher

Usage: $SCRIPT_NAME <command> [args...]

Commands:
  status      Show codespace status
  clean       Free disk space
  restart     Restart services
  update      Update repositories safely
  services    Manage services (status/start/stop/logs)
  forward     Forward ports from a codespace
  ws          Worktree + PR management

Examples:
  cs status
  cs clean --dry-run
  cs restart --full --wait
  cs update --dry-run
  cs services status
  cs forward -c my-codespace
  cs ws list

Tip: Run '<command> --help' for detailed usage.
EOF
}

error() { echo "Error: $*" >&2; }

if [[ $# -eq 0 ]]; then
    usage
    exit 0
fi

case "$1" in
    -h|--help)
        usage
        exit 0
        ;;
    status|clean|restart|update|services|forward|ws)
        cmd="$1"
        shift
        ;;
    *)
        error "Unknown command: $1"
        echo "Run 'cs --help' for usage" >&2
        exit 1
        ;;
esac

script_path="${SCRIPTS_DIR}/cs-${cmd}"
if [[ "$cmd" == "ws" ]]; then
    script_path="${SCRIPTS_DIR}/ws"
fi

if [[ ! -x "$script_path" ]]; then
    error "Command not found or not executable: $script_path"
    exit 1
fi

exec "$script_path" "$@"
